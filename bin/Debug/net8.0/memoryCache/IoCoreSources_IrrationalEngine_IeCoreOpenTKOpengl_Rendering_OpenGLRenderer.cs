{"embedding":[-0.014282268,-0.034460753,-0.004523447,-0.035555758,0.002411401,-0.04041362,-0.027739018,-0.020699762,0.035997845,0.025596675,0.021865668,-0.009816999,0.035392046,-0.04925352,-0.0010198269,0.019777903,-0.025981022,-0.044123303,-0.06871877,-0.007877854,-0.0043289997,0.009477044,-0.089181945,-0.064288475,-0.013424368,0.030522546,0.023264922,-0.0034003523,0.061987925,0.04502627,-0.049899567,0.0060458416,-0.0058789877,-0.039920148,0.0053634555,0.01145588,0.02348021,-0.022351217,-0.015551265,-0.009573436,0.036748305,-0.010108942,0.018907115,-0.070143506,-0.030028928,-0.021329356,0.008355278,-0.019469624,0.035032663,-0.018219419,-0.01583772,0.027781881,-0.018479008,-0.007053422,-0.037571758,-0.041121885,-0.0011122802,-0.0042882324,-0.02187515,0.018349113,0.037057564,0.013874609,-0.012688127,-0.06911796,0.053071048,0.058742102,0.015586698,-0.005630741,-0.0005911349,0.02676474,-0.053539883,0.04520912,0.006913254,-0.013764678,-0.0050757676,0.025312645,-0.02447776,0.010186868,0.0020574024,-0.00041517735,-0.018211229,0.01782388,-0.02720076,-0.002347039,-0.027875252,-0.017844746,0.009545596,0.003915158,0.014735479,-0.03380004,-0.040027894,0.039593168,-0.020844689,0.03054272,0.002298248,0.0386341,-0.03201078,0.033034302,0.00807765,-0.01801616,0.024986697,0.086499706,-0.04048491,0.03990475,-0.00081965077,-0.0036577543,-0.0011647828,0.029632306,-0.06271659,-0.061885778,0.052281376,-0.007967007,0.033513263,0.0065826783,0.017541975,0.03565195,0.0010319339,0.012458425,-0.0244866,-0.0113791665,0.04452503,0.017568368,0.01803289,-0.054431416,0.007090401,-0.0071761897,0.043983452,0.07168938,-0.036079586,0.0066249347,0.040777896,-0.01694107,-0.002976508,0.019901354,-0.042691868,0.015289895,0.025771994,0.013065182,0.025926875,-0.016555892,-0.009198088,0.0126678655,-0.03962334,0.07839901,0.007154896,0.033353448,-0.004891557,0.015188116,-0.030457854,0.0024232322,-0.026485039,-0.008087977,0.0066685006,0.0100765955,-0.001745771,-0.016648814,-0.020947877,0.027550753,0.034149986,-0.006534123,0.06603999,0.004137201,-0.0424625,0.029909391,0.009185077,0.052200463,-0.049797304,-0.054694574,-0.0068775224,0.026064167,0.01666574,-0.0023466845,0.0011356592,-0.020322144,0.04261069,0.025457378,0.020969192,0.0181221,-0.0023179366,0.015685145,-0.0030648732,-0.018716726,-0.022015601,0.048333693,0.0030248284,0.014744421,0.02547686,-0.027499972,-0.041670512,0.0034857614,0.0375906,0.037664507,-0.030122954,0.038220778,-0.014932305,0.022957474,-0.026923621,-0.009884303,-0.039732903,-0.07785682,0.01237505,0.009782186,-0.032302164,-0.03253883,-0.014265739,-0.011520148,0.019766608,0.053788792,-0.0033248905,0.00480165,0.021209972,0.018494016,-0.040074117,0.010915318,0.0349962,-0.0021817528,-0.012985377,0.0093482705,-0.005997972,0.05260914,0.022409882,0.027202057,0.025733314,0.024714144,-0.020068102,-0.0037524784,-0.0019733587,0.002321449,0.015824636,0.0021694372,0.019250564,0.028033137,-0.017517552,0.051024307,0.0054555763,0.021133495,0.03001627,0.0005826853,0.010108688,0.002396633,-0.0236511,0.042218473,0.0074268463,-0.0003627142,0.0076537402,-0.036392916,0.0008368411,-0.011179897,-0.017244834,-0.0068750107,-0.008079279,0.05021922,0.009898644,-0.0081448415,-0.045449674,-0.03373303,0.038912274,0.031917993,-0.014091292,-0.05355376,0.008924774,0.029640565,0.009886288,-0.0067130052,0.026860487,0.03058062,-0.007446622,-0.013703801,-0.020056907,-0.04602736,-0.05574255,0.0042040073,-0.050064147,-0.011374486,0.0033512881,-0.021757886,0.043988504,-0.031023523,0.039916143,0.047458157,-0.0034217308,-0.039334927,-0.05583343,0.03662728,0.021632077,0.015498171,0.0057436326,0.018864885,-0.0022542372,0.012571333,-0.046958625,-0.00416815,0.00906516,0.007762964,-0.009297253,-0.03814706,-0.011316129,-0.050318938,-0.020015076,-0.0103653185,-0.024853015,-0.032229427,-0.03839245,0.0074884235,-0.024401579,0.038646214,0.016215796,-0.027770355,0.055712648,0.014866237,-0.06256521,0.033499468,0.00039954117,-0.013303716,-0.052736506,0.045102604,0.024709783,-0.0061015757,-0.016467655,-0.005871276,0.01679298,0.0036088624,-0.043089584,-0.033997215,-0.026043259,0.025405923,0.009628967,-0.034325626,0.016325789,-0.045370046,-0.016156247,-0.037375316,-0.018507017,0.04397226,0.006186865,0.044178396,0.0047581256,-0.007598773,0.00080886245,-0.0132978475,0.036943756,-0.026143972,0.024101017,0.03776749,-0.011605795,0.038100574,0.02426519,-0.03435076,0.025922505,-0.029341767,-0.027335098,-0.028903607,-0.023421485,0.004520018,0.043684874,0.035680685,-0.019090358,0.012797047,0.01600181,-0.006700855,0.05752345,0.0022417554,0.056937452,-0.03817247,-0.003409834,-0.050500117,-0.015535513,0.03622168,0.043552924,-0.039503362,0.01250385,-0.018893003,-0.04518675,-0.02534021,0.0068874257,-0.004324833,0.023716886,0.0085863825,0.020716794,-0.025170607,-0.014917541,-0.019394696,-0.009381189,0.0291124,0.036623437,-0.020679697,-0.005225197,0.0071881036,-0.019834822,-0.04008508,-0.02720942,0.0064612394,-0.005071496,-0.051418748,-0.024316078,-0.038196474,0.0468605,0.058775626,0.053557664,0.024159696,-0.0008029958,-0.041067995,0.017133638,0.027225224,-0.065567516,-0.007611396,-0.016135233,0.04661067,-0.021188969,-0.0009680101,-0.07110383,-0.008498707,-0.048862666,0.026853567,0.032232385,0.016514698,-0.047384463,0.015569519,0.016851313,0.044406816,0.0014535245,-0.0395025,0.036644083,0.019072194,0.040577307,-0.029717466,-0.007181789,-0.042032156,0.012325407,0.019119803,-0.05315932,-0.025083618,-0.011798288,0.0011684381,0.0058417474,0.016986448,0.033090916,0.0019106211,0.010305309,-0.015226599,0.013299922,0.019906238,-0.031852998,-0.004499669,-0.0028045196,-0.013751363,0.00015815452,0.0144523,0.0057664593,0.02185828,0.010772521,-0.036339115,0.059085213,-0.0033592256,0.007020448,-0.01809353,0.027599989,0.028366342,0.070565276,-0.009008897,-0.03849382,-0.06319294,0.00023263434,-0.032920398,-0.047889218,0.028532386,-0.015835296,0.023918496,0.022582347,0.00239753,-0.021917788,0.040826924,0.015036112,-0.043095622,0.008935009,-0.06809681,0.008606153,0.007929798,-0.017466549,0.030709058,-0.033060893,0.0363289,-0.0004724925,-0.0524615,-0.028183354,-0.02710787,-0.0024736705,0.0068725278,0.0016558593,0.027468212,-0.002410741,-0.0035001144,0.02293409,-0.023775125,0.037848387,-0.025032606,-0.013745259,0.041164353,0.04816532,-0.019530442,-0.013007027,0.009723662,-0.08321862,-0.0128418645,-0.03926489,0.050684165,-0.022108778,0.004619991,-0.04939491,0.011966079,-0.030486034,0.011561793,-0.021224272,-0.00744248,0.044271827,0.020563904,0.009161773,-0.014290357,-0.004895511,0.04135706,0.0034121121,-0.043370724,-0.01826466,0.045764554,0.030540766,0.024332155,0.007429168,0.004254068,-0.046195332,-0.019499646,0.021596398,-0.0036272355,-0.013877668,-0.052737467,-0.032302484,0.02469366,0.026098082,-0.0053458335,-0.06494238,0.014345546,-0.040794328,0.017441707,-0.015227728,-0.023266982,-0.02041922,0.020630686,0.0045768325,0.043625638,0.011656817,0.034562062,0.01845232,0.040518466,0.028846147,0.031690873,-0.013662373,-0.042104453,-0.0031887416,-0.008169091,-0.0092603145,0.013696657,-0.010769378,-0.0015062222,-0.028365884,0.013430854,0.03159153,0.009258988,-0.0011751368,-0.06969814,0.025784561,-0.0278907,0.009989104,-0.0079881875,0.05396679,0.01143165,0.0072821137,-0.02080117,-0.01859554,-0.037444185,-0.042378098,0.0063164583,-0.034834865,-0.049208693,-0.039612915,-0.004814576,0.037326016,0.0018207292,0.028162276,0.047774713,0.032437433,-0.011035626,-0.036960572,0.008142703,0.034384105,-0.026270397,0.0064794812,-0.037415374,-0.039016895,-0.0016174755,-0.020764047,-0.05044034,-0.051861007,0.029799307,-0.009454363,-0.026887983,0.018498894,-0.008096718,-0.03826217,-0.02628091,0.03375667,-0.0042539556,0.020158585,0.030268613,0.035076704,0.016478354,0.076325364,-0.0149986185,-0.029396987,0.003349765,0.04426172,-0.017760037,-0.019338047,0.01911861,0.031027643,-0.0723211,-0.038735136,-0.019662438,-0.01767117,0.012024692,-0.05611782,-0.008321263,-0.07999938,0.006386935,-0.0066732755,0.025030296,0.012499117,0.0073881163,0.032945644,-0.00647008,-0.020078218,0.0014295103,0.066825345,-0.029844157,-0.0052702217,-0.033903647,-0.01281365,-0.03182844,0.009744825,0.018548269,0.010070267,0.030860882,0.01881464,0.0038281581,0.0914623,-0.0035171348,0.033933673,-0.026599946,-0.016915107,-0.05565293,-0.021900864,0.011769683,0.04666181,0.0074770343,-0.028558196,-0.0036775926,0.01860285,0.004700863,-0.008120884,-0.02354747,-0.022021798,-0.07112605,0.0046074563,-0.008859009,-0.008156629,-0.005503198,-0.0006980128,0.04425854,-0.0064898147,0.044962615,0.008063442,0.0040309904,0.04241049,-0.030592138,-0.005143503,-0.029498264,-0.060248625,-0.03494991,-0.028984714,0.007929876,0.010113171,-0.0059346044,0.006176069,-0.043852277,0.07467459,-0.010812228,-0.03090256,0.023961607,0.014011917,0.0038538184,0.008949703,-0.011172996,0.03969013,0.03338686,-0.03989238,-0.015996402,-0.027021265,-0.026011292,-0.026099894,0.034508638,-0.008194898,0.02656084,-0.010505564,0.009996882,0.050495163,-0.01564153,0.011762794,0.01103396,0.0030532537,-0.036250673,0.029643854,0.027893832,0.03577588,-0.0011062195,0.05929135,-0.009707799,-0.016178172,-0.016978698,0.01818944,0.04026689,0.0007335587,0.0037893152,-0.004800675,0.025204733,0.0059967325,-0.012257713,0.062589176,-0.04752278,-0.008543214,-0.011193934,0.0007284711,0.008845058,0.05582422,0.027418604,0.0030052841,-0.01368607,-0.018744802,-0.020500401,0.014193647,-0.013620455,-0.04662405,-0.0002491046,-0.055617895,0.032080706,-0.008297548,0.0015845206,0.008277341,-0.019040205,-0.012523239,0.012881615,0.016888257,0.006140745,0.029153876,-0.07363206,0.015181257,0.034656838,0.033260204,-0.03052562,-0.06913085,0.012008135,0.024497092,0.011530952,-0.012273498,-0.0010233832,0.00957782,-0.050569735,0.07059807,0.025669415,-0.014780875,-0.06612784,0.02444778,-0.04589735,0.036464147,-0.035252962,0.0015510881,0.010419512,-0.011192756,-0.01077645,0.055538446,0.0497479,-0.028745798,0.07515772,0.017758938,0.01355248,-0.030939838,-0.024279583,-0.028804876,0.043974355,0.04250214,0.054225624,-0.0065141744,0.014318775,0.008439438,0.012452477,0.03122412,0.04950257,0.025963346,-0.00597662,-0.0048677595,-0.008407755,0.0009395271,0.019586612,0.019951014,-0.009560707,-0.021082526,-0.011332461,-0.028460734,-0.0033787042,0.025646534,-0.020256177,0.051154166,0.0016059768,-0.02218723,0.04361972,0.030559797,-0.015852982,0.016374838,-0.009332527,0.030903945,-0.04713407,-0.0023701524,0.008949887,0.009040241,-0.02733167,-0.013322069,0.05979677,-0.005614582,-0.036456723,-0.0339574,-0.030934118,0.010308797,-0.024102164,0.002686007,-0.0022734695,-0.053269845,-0.0037272177,-0.040115032,0.004711932,-0.04684983,-0.011225269,0.03290009,0.01250742,-0.021093534,0.032950606,-0.03095427,0.039122835,-0.008937204,0.054716527,-0.00046952046,0.09802037,0.017100796,0.012891112,5.365389E-06,-0.019056978,-0.035996374,-0.021640822,0.0074560274,-0.011670259,0.01939395,-0.048215806,-0.07648561,0.0128995385,0.062954456,-0.023049438,-0.03843959,0.0041407673,0.0354239,-0.05968485,-0.008409335,0.040576153,0.018595818,0.028596478,-0.0037117763,-0.05852947,-0.043403987,-0.027830305,-0.047884077,0.045300603,-0.034722954,-0.01497827,-0.04128916,-0.017496582,-0.00535029,-0.0018628982,0.0026386452,0.016490733,0.020176392,0.071079485,-0.0044827703,0.030167859,-0.014994201,-0.05036792,0.042622138,0.050974008,0.009467032,0.03578431,0.044151835,0.037890103,0.017396083,0.0155979935,-0.0065156454,-0.024272002,-0.00994369,0.026838828,0.011481606,-0.023266042,-0.020623147,-0.02825868,0.06077803,-0.05962688,0.021070702,-0.051076464,-0.008123959,-0.060197882,-0.00094966346,-0.04600714,0.013589441,-0.024421947,-0.0014983595,0.03269378,-0.026236534,0.20721401,0.021252587,0.060671967,0.036630083,0.05573386,0.09231223,0.015101408,-0.020411585,-0.001008131,-0.06945008,0.02568552,-0.0018428771,0.03433389,0.019733364,-0.02924347,0.055002056,-0.056779232,-0.015764115,0.007885238,-0.0757648,-0.04800841,0.0032989155,0.008323169,0.015731392,-0.024821114,-0.0051800455,0.009836032,-0.03179083,-0.0398572,-0.038678143,0.0058029993,-0.008075779,-0.0067300783,0.0061988286,-0.022403903,0.05751097,0.02518496,-0.027261872,-0.0135286795,-0.011988021,-0.029983237,-0.039039988,-0.010517147,0.0013623433,0.0021656584,-0.002594243,-0.0026040615,-0.01631396,0.06984069,-0.057606466,0.05721498,-0.05352665,-0.017849006,-0.03159734,-0.029101312,0.01871867,-0.0070160865,0.0022804243,-0.0061527397,0.0041078804,0.018002383,-0.01198803,-0.0030366604,0.023490664,-0.035621718,0.019804021,-0.021207027,0.026433587,-0.038644806,-0.017910741,0.0069795703,-0.0037563685,0.02814455,0.02102821,0.021670789,0.03751177,-0.0030471715,0.038875606,0.0146834375,-0.0077945925,0.010899705,-0.015746096,0.021322612,0.023131825,0.022701247,0.04529861,-0.045521826,-0.028769296,-0.020743,0.02703754,0.027552485,0.06909515,-0.031293172,-0.02165002,0.0029389574],"metadata":{"is_reference":false,"external_source_name":"","id":"_IrrationalEngine_IeCoreOpenTKOpengl_Rendering_OpenGLRenderer.cs","description":"","text":"using IeCoreEntities.Materials;\nusing IeCoreInterfaces;\nusing IeCoreInterfaces.Assets;\nusing IeCoreInterfaces.Rendering;\nusing IeCoreInterfaces.SceneObjectComponents;\nusing IeCoreOpenTKOpengl.Extensions;\nusing IeUtils;\nusing Microsoft.Extensions.Logging;\nusing OpenTK.Graphics.OpenGL;\nusing OpenTK.Mathematics;\nusing System;\nusing System.Collections.Generic;\nusing System.Linq;\nusing System.Text;\nusing IeCoreOpenTKOpengl.Helpers;\n\nnamespace IeCoreOpenTKOpengl.Rendering\n{\n\tpublic class OpenGlRenderer : IRenderer\n\t{\n\t\tprivate const string ModelObjectComponent = \u0022ModelSceneObjectComponent\u0022;\n\t\tprivate const string MaterialObjectComponent = \u0022MaterialSceneObjectComponent\u0022;\n\t\tprivate const string AnimationSceneObjectComponent = \u0022AnimationSceneObjectComponent\u0022;\n\t\tprivate readonly ISceneManager _sceneManager;\n\t\tprivate ISceneObjectComponent _materialObjectComponent;\n\t\tprivate ISceneObjectComponent _modelObjectComponent;\n\t\tprivate ISceneObjectComponent _animationObjectComponent;\n\t\tprivate readonly IUniformHelper _uniformHelper;\n\t\tprivate readonly ILogger\u003COpenGlRenderer\u003E _logger;\n\t\tprivate readonly IAssetManager _assetManager;\n\t\tprivate Matrix4 _projection;\n\t\tprivate Matrix4 _view;\n\t\tprivate ISceneObjectComponent _camera;\n\n\t\tpublic OpenGlRenderer(ISceneManager sceneManager, IUniformHelper uniformHelper, IAssetManager assetManager, ILogger\u003COpenGlRenderer\u003E logger)\n\t\t{\n\t\t\tsceneManager.AssertNotNull(nameof(sceneManager));\n\t\t\tuniformHelper.AssertNotNull(nameof(uniformHelper));\n\t\t\tlogger.AssertNotNull(nameof(logger));\n\t\t\tassetManager.AssertNotNull(nameof(assetManager));\n\t\t\t_sceneManager = sceneManager;\n\t\t\t_uniformHelper = uniformHelper;\n\t\t\t_logger = logger;\n\t\t\t_assetManager = assetManager;\n\t\t}\n\n\t\tprivate int _width = 600, _height = 600;\n\t\tpublic void OnLoad()\n\t\t{\n\t\t\tGL.Enable(EnableCap.DepthTest);\n\t\t\tGL.ClearColor(0.2f, 0.3f, 0.3f, 1.0f);\n\n\t\t\t//Generate textures\n\t\t\tforeach (Texture texture in _assetManager.RetrieveAll\u003CTexture\u003E())\n\t\t\t{\n\t\t\t\ttexture.Id = GL.GenTexture();\n\t\t\t}\n\t\t\tforeach (ISceneObject sceneObject in _sceneManager.Scene.SceneObjects)\n\t\t\t{\n\t\t\t\t//Find model component in scene object.\n\t\t\t\tif (sceneObject.Components.TryGetValue(ModelObjectComponent, out _modelObjectComponent))\n\t\t\t\t{\n\t\t\t\t\t//Get model from scene object.\n\t\t\t\t\tvar currentModelComponent = (IModelComponent)_modelObjectComponent;\n\t\t\t\t\t//Generate VAO on OGL side and assign id of that buffer to model.\n\t\t\t\t\tcurrentModelComponent.Model.VertexArrayObjectId = GL.GenVertexArray();\n\t\t\t\t\tGL.BindVertexArray(currentModelComponent.Model.VertexArrayObjectId);\n\t\t\t\t\t//Generate buffer on OGL side and assign id of that buffer to model.\n\t\t\t\t\tcurrentModelComponent.Model.VertexBufferObjectId = GL.GenBuffer();\n\t\t\t\t\t//Generate buffer on OGL side and assign id of that buffer to model.\n\t\t\t\t\tcurrentModelComponent.Model.ElementBufferId = GL.GenBuffer();\n\n\t\t\t\t\t//Get all vertices from model.\n\t\t\t\t\tfloat[] vboPositionData = currentModelComponent.GetVboPositionDataOfModel();\n\t\t\t\t\tuint[] indexes = currentModelComponent.GetIndexesOfModel();\n\n\t\t\t\t\tvar sb = new StringBuilder(\u0022Vertex coordinates: \u0022);\n\t\t\t\t\tsb.Append(currentModelComponent.Model.Name);\n\t\t\t\t\tforeach (float posData in vboPositionData)\n\t\t\t\t\t{\n\t\t\t\t\t\tsb.Append(\u0027 \u0027);\n\t\t\t\t\t\tsb.Append(posData);\n\t\t\t\t\t}\n\t\t\t\t\t_logger.LogTrace(sb.ToString());\n\t\t\t\t\t//Load indices data to GPU.\n\t\t\t\t\tGL.BindBuffer(BufferTarget.ElementArrayBuffer, currentModelComponent.Model.ElementBufferId);\n\t\t\t\t\tGL.BufferData(BufferTarget.ElementArrayBuffer, indexes.Length * sizeof(uint), indexes, BufferUsageHint.StaticDraw);\n\n\n\t\t\t\t\tif (sceneObject.Components.TryGetValue(MaterialObjectComponent, out _materialObjectComponent))\n\t\t\t\t\t{\n\t\t\t\t\t\t//Get material from scene object.\n\t\t\t\t\t\tvar currentMaterialComponent = (IMaterialComponent)_materialObjectComponent;\n\t\t\t\t\t\tTexture texture = currentMaterialComponent.Materials.FirstOrDefault().Value.DiffuseTexture;\n\n\t\t\t\t\t\tGL.BindTexture(TextureTarget.Texture2D, texture.Id);\n\n\t\t\t\t\t\tGL.TexImage2D(TextureTarget.Texture2D,\n\t\t\t\t\t\t   0,\n\t\t\t\t\t\t   PixelInternalFormat.Srgb8,\n\t\t\t\t\t\t   (int)texture.TextureSize.X,\n\t\t\t\t\t\t   (int)texture.TextureSize.Y,\n\t\t\t\t\t\t   0,\n\t\t\t\t\t\t   PixelFormat.Bgra,\n\t\t\t\t\t\t   PixelType.UnsignedByte,\n\t\t\t\t\t\t   texture.Bytes);\n\n\t\t\t\t\t\tGL.GenerateMipmap(GenerateMipmapTarget.Texture2D);\n\n\n\t\t\t\t\t\t//Bind created buffer to ArrayBuffer target.\n\t\t\t\t\t\tGL.BindBuffer(BufferTarget.ArrayBuffer, currentModelComponent.Model.VertexBufferObjectId);\n\n\t\t\t\t\t\t//Load model data to GPU.\n\t\t\t\t\t\tGL.BufferData(BufferTarget.ArrayBuffer, vboPositionData.Length * sizeof(float), vboPositionData, BufferUsageHint.StaticDraw);\n\n\t\t\t\t\t\tGL.VertexAttribPointer(currentMaterialComponent.ShaderProgram.GetAttributeAddress(\u0022aPosition\u0022),\n\t\t\t\t\t\t\t3, VertexAttribPointerType.Float, false, 0, 0);\n\n\t\t\t\t\t\t//TODO: use strategy because here will be added normals and other stuff\n\t\t\t\t\t\tif (currentMaterialComponent.ShaderProgram.GetAttributeAddress(\u0022aTexCoord\u0022) != -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfloat[] vboTextureData = currentModelComponent.GetVboTextureDataOfModel();\n\t\t\t\t\t\t\tGL.BindBuffer(BufferTarget.ArrayBuffer, currentMaterialComponent.ShaderProgram.GetBuffer(\u0022aTexCoord\u0022));\n\t\t\t\t\t\t\tGL.BufferData(BufferTarget.ArrayBuffer, vboTextureData.Length * sizeof(float), vboTextureData, BufferUsageHint.StaticDraw);\n\t\t\t\t\t\t\tGL.VertexAttribPointer(currentMaterialComponent.ShaderProgram.GetAttributeAddress(\u0022aTexCoord\u0022), 2, VertexAttribPointerType.Float, false, 0, 0);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (sceneObject.Components.TryGetValue(AnimationSceneObjectComponent, out _animationObjectComponent))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tIAnimationComponent currentAnimationComponent = (IAnimationComponent)_animationObjectComponent;\n\t\t\t\t\t\t\tList\u003CTuple\u003Cint, float\u003E\u003E[] weights = currentModelComponent.Model.Meshes[0].Skeleton.Bones.Select(x =\u003E x.VertexWeights).ToArray();\n\t\t\t\t\t\t\t//Flatten weights according to indices.\n\t\t\t\t\t\t\tList\u003Cfloat\u003E flattenedWeights = new List\u003Cfloat\u003E();\n\t\t\t\t\t\t\tList\u003Cint\u003E boneIds = new List\u003Cint\u003E();\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tfor (int i = 0; i \u003C indexes.Length; i\u002B\u002B)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfor (int j = 0; j \u003C currentModelComponent.Model.Meshes[0].Skeleton.Bones.Count; j\u002B\u002B)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tforeach (Tuple\u003Cint, float\u003E vertexWeight in currentModelComponent.Model.Meshes[0].Skeleton.Bones[j].VertexWeights)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tif (vertexWeight.Item1 == indexes[i])\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tflattenedWeights.Add(vertexWeight.Item2);\n\t\t\t\t\t\t\t\t\t\t\tboneIds.Add(j);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t//_logger.LogDebug(i.ToString() \u002B \u0022-\u0022 \u002B weights.SelectMany(x =\u003E x).Select(x =\u003E x.Item1).Where(y =\u003E y == indexes[i]).ToArray().Length.ToString());\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tMatrix4[] offsetmatrix = currentModelComponent.Model.Meshes[0].Skeleton.Bones.Select(x =\u003E x.OffsetMatrix.ConvertToOpenTkMatrix4()).ToArray();\n\t\t\t\t\t\t\t_uniformHelper.TryAddUniform(offsetmatrix, \u0022Bones\u0022, currentMaterialComponent.ShaderProgram);\n\n\t\t\t\t\t\t\t//Load bones ids to GPU\n\t\t\t\t\t\t\tvar flattenedWeightsArray = flattenedWeights.ToArray();\n\t\t\t\t\t\t\tGL.BindBuffer(BufferTarget.ArrayBuffer, currentMaterialComponent.ShaderProgram.GetBuffer(\u0022Weights\u0022));\n\t\t\t\t\t\t\tGL.BufferData(BufferTarget.ArrayBuffer, flattenedWeightsArray.Length * sizeof(float), flattenedWeightsArray, BufferUsageHint.StaticDraw);\n\n\t\t\t\t\t\t\tGL.VertexAttribPointer(currentMaterialComponent.ShaderProgram.GetAttributeAddress(\u0022Weights\u0022),\n\t\t\t\t\t\t\t\t4, VertexAttribPointerType.Float, false, 0, 0);\n\n\t\t\t\t\t\t\t//Load bones ids to GPU\n\t\t\t\t\t\t\tvar boneIdsArray = boneIds.ToArray();\n\n\t\t\t\t\t\t\tGL.BindBuffer(BufferTarget.ArrayBuffer, currentMaterialComponent.ShaderProgram.GetBuffer(\u0022BoneIDs\u0022));\n\t\t\t\t\t\t\tGL.BufferData(BufferTarget.ArrayBuffer, boneIdsArray.Length * sizeof(uint), boneIdsArray, BufferUsageHint.StaticDraw);\n\n\t\t\t\t\t\t\tGL.VertexAttribPointer(currentMaterialComponent.ShaderProgram.GetAttributeAddress(\u0022BoneIDs\u0022),\n\t\t\t\t\t\t\t\t4, VertexAttribPointerType.UnsignedInt, false, 0, 0);\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t_projection = Matrix4.CreatePerspectiveFieldOfView(1.3f, _width / (float)_height, 0.1f, 120.0f);\n\t\t\t}\n\t\t}\n\n\t\tpublic void OnRender()\n\t\t{\n\t\t\tGL.Clear(ClearBufferMask.ColorBufferBit | ClearBufferMask.DepthBufferBit);\n\t\t\tGL.CullFace(CullFaceMode.Back);\n\n\n\t\t\tforeach (ISceneObject sceneObject in _sceneManager.Scene.SceneObjects.ToList())\n\t\t\t{\n\t\t\t\tif (sceneObject.Components.TryGetValue(\u0022Camera\u0022, out _camera))\n\t\t\t\t{\n\t\t\t\t\tvar camera = (ICamera)_camera;\n\t\t\t\t\t_view = camera.GetViewMatrix().ConvertToOpenTkMatrix4();\n\t\t\t\t}\n\t\t\t\tIMaterialComponent currentMaterialComponent = null;\n\t\t\t\tif (sceneObject.Components.TryGetValue(MaterialObjectComponent, out _materialObjectComponent))\n\t\t\t\t{\n\t\t\t\t\t//Get material from scene object.\n\t\t\t\t\tcurrentMaterialComponent = (IMaterialComponent)_materialObjectComponent;\n\t\t\t\t\tcurrentMaterialComponent.ShaderProgram.EnableVertexAttribArrays();\n\t\t\t\t\tTexture texture = currentMaterialComponent.Materials.FirstOrDefault().Value.DiffuseTexture;\n\n\t\t\t\t\t_uniformHelper.TryAddUniformTexture2D(texture.Id, \u0022texture0\u0022, currentMaterialComponent.ShaderProgram, TextureUnit.Texture0);\n\n\t\t\t\t\tcurrentMaterialComponent.ShaderProgram.UseProgram();\n\n\t\t\t\t\t_uniformHelper.TryAddUniform(currentMaterialComponent.Materials.FirstOrDefault().Value.DiffuseColor.ConvertToOpenTkVector(),\n\t\t\t\t\t\t\u0022Color\u0022,\n\t\t\t\t\t\tcurrentMaterialComponent.ShaderProgram);\n\t\t\t\t}\n\n\t\t\t\t//Get all vertices from model.\n\t\t\t\tif (sceneObject.Components.TryGetValue(ModelObjectComponent, out _modelObjectComponent))\n\t\t\t\t{\n\t\t\t\t\t//Get model from scene object.\n\t\t\t\t\tvar currentModelComponent = (IModelComponent)_modelObjectComponent;\n\n\t\t\t\t\tGL.BindVertexArray(currentModelComponent.Model.VertexArrayObjectId);\n\t\t\t\t\tGL.BindBuffer(BufferTarget.ElementArrayBuffer, currentModelComponent.Model.ElementBufferId);\n\n\n\t\t\t\t\tMatrix4 modelMatrix = currentModelComponent.Model.Meshes.FirstOrDefault().Transform.ModelMatrix.ConvertToOpenTkMatrix4();\n\t\t\t\t\tGL.UniformMatrix4(currentMaterialComponent.ShaderProgram.GetUniformAddress(\u0022model\u0022), false, ref modelMatrix);\n\t\t\t\t\tGL.UniformMatrix4(currentMaterialComponent.ShaderProgram.GetUniformAddress(\u0022projection\u0022), false, ref _projection);\n\t\t\t\t\tGL.UniformMatrix4(currentMaterialComponent.ShaderProgram.GetUniformAddress(\u0022view\u0022), false, ref _view);\n\n\t\t\t\t\t// Bind the VAO\n\t\t\t\t\tGL.BindVertexArray(currentModelComponent.Model.VertexArrayObjectId);\n\n\t\t\t\t\tGL.DrawElements(PrimitiveType.Triangles, currentModelComponent.GetIndexesOfModel().Length, DrawElementsType.UnsignedInt, 0);\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\tpublic void OnResized()\n\t\t{\n\t\t\tGL.Viewport(0, 0, _width, _height);\n\t\t\t_projection = Matrix4.CreatePerspectiveFieldOfView(1.3f, _width / (float)_height, 0.1f, 120.0f);\n\t\t}\n\n\t\tpublic void OnUnload()\n\t\t{\n\n\t\t\t//TODO: Clean up all buffers.\n\t\t\tthrow new NotImplementedException();\n\t\t}\n\n\t\tpublic void OnUpdated()\n\t\t{\n\t\t\t//throw new NotImplementedException();\n\t\t}\n\n\t\tpublic void SetContext\u003CT\u003E(T context)\n\t\t{\n\t\t\tthrow new NotImplementedException();\n\t\t}\n\n\t\tpublic void SetViewPort(int width, int height)\n\t\t{\n\t\t\t_width = width;\n\t\t\t_height = height;\n\t\t}\n\t}\n}\n","additional_metadata":""},"key":"_IrrationalEngine_IeCoreOpenTKOpengl_Rendering_OpenGLRenderer.cs","timestamp":null}